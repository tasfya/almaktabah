<div class="card bg-base-100 shadow-sm border border-base-300 mb-4">
  <div class="card-body p-4">
    <%= search_form_for @q, url: request.path, method: :get, local: true, class: "space-y-4" do |form| %>
      <div class="space-y-4 sm:space-y-0 sm:grid sm:grid-cols-1 md:grid-cols-3 sm:gap-4">
        
        <!-- Search field -->
        <div>
          <%= form.label :title_or_description_cont, t('forms.labels.search'),
              class: "label-text mb-2 block" %>
          <%= form.search_field :title_or_description_cont,
              placeholder: t('forms.placeholders.search_title_description'),
              class: "input input-bordered w-full" %>
        </div>

        <!-- Series filter (only for lessons) -->
        <% if defined?(@series) && @series.present? && controller_name == "lessons" %>
          <div>
            <%= form.label :series_id_eq, t('forms.labels.series'),
                class: "label-text mb-2 block" %>
            <%= form.select :series_id_eq,
                options_for_select([[t('forms.options.all_series'), ""]] + @series.pluck(:title, :id),
                params.dig(:q, :series_id_eq)),
                {},
                { class: "select select-bordered w-full" } %>
          </div>
        <% end %>

        <!-- Sort dropdown -->
        <div>
          <%= form.label :s, t('forms.labels.sort_by'),
              class: "label-text mb-2 block" %>
          <%= form.select :s,
              options_for_select([
                [t('forms.options.newest'), "created_at desc"],
                [t('forms.options.oldest'), "created_at asc"],
                [t('forms.options.name_asc'), "title asc"],
                [t('forms.options.name_desc'), "title desc"],
                [t('forms.options.most_downloaded'), "downloads desc"]
              ].select { |option|
                option[1] != "downloads desc" || controller_name == "books"
              }, params.dig(:q, :s)),
              { include_blank: t('forms.options.default') },
              { class: "select select-bordered w-full" } %>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 pt-4">
        <%= form.submit t('buttons.apply_filter'),
            class: "btn btn-primary w-full sm:w-auto" %>
        <%= link_to t('buttons.reset'), request.path,
            class: "btn btn-outline w-full sm:w-auto" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Results info -->
<div class="flex justify-between items-center mb-4 px-1">
  <div class="text-xs sm:text-sm text-base-content/70">
    <% if defined?(@pagy) && @pagy && @pagy.count > 0 %>
      <%= t('pagination.results_info', from: @pagy.from, to: @pagy.to, count: @pagy.count) %>
    <% end %>
  </div>
</div>
